# Structural vs. Sequence Phylogeny

**Tanglegram-Based Congruence Analysis**

This project compares a structural guide tree generated by FoldMason against an amino acid maximum-likelihood tree inferred with IQ-TREE. The objective is to evaluate whether protein structural similarity recapitulates sequence-based phylogeny.

The workflow produces:

- A publication-quality tanglegram
- Quantitative tree congruence metrics
- Fully reproducible outputs

---

## Repository Structure

```
.
├── data/
│   ├── lysB_structural.nw
│   └── lysB_AA_ML.contree
├── scripts/
│   └── tree_comparison.R
├── results/
└── README.md
```

---

## Workflow

### 1. Input & Preprocessing

- Trees are read using `ape::read.tree()`
- Taxa are synchronized (shared tip intersection)
- Midpoint rooting is applied
- Polytomies are resolved only if necessary (`multi2di()`)
- Trees are ladderized for consistent visual ordering

This ensures topological comparability without altering underlying relationships.

### 2. Dendrogram Conversion (Ultrametric-Free)

Maximum-likelihood trees are not ultrametric. To avoid imposing a molecular clock assumption:

1. Cophenetic (patristic) distance matrices are computed
2. Hierarchical clustering (`hclust()`) is performed
3. Trees are converted to dendrogram objects

This preserves relative topology while enabling tanglegram comparison via `dendextend`.

### 3. Structural Clustering & Coloring

Clusters are derived exclusively from the structural dendrogram using a relative height cutoff:

```
h = 0.25 × max(dendrogram height)
```

These structural clusters determine:

- Tip label colors
- Tanglegram connecting line colors

Branch edges are rendered in neutral gray to emphasize cross-tree correspondence.

### 4. Tanglegram Generation

The dendrograms are untangled to minimize line crossings, then exported as a high-resolution PNG:

```
results/AA_vs_Struct_tanglegram.png
```

---

## Quantitative Congruence Metrics

Metrics are written to:

```
results/AA_vs_Struct_tree_metrics.csv
```

| Metric | Method | Interpretation |
|--------|--------|----------------|
| **Normalized Robinson–Foulds** | `RF.dist(unroot(tL), unroot(tR), normalize=TRUE)` | 0 = identical topology, 1 = maximally different |
| **Entanglement** | `dendextend::entanglement()` | 0 = perfect visual alignment, 1 = maximal crossing |

---

## Biological Interpretation

This workflow addresses a core evolutionary question:

> **Do structural similarity relationships mirror amino acid phylogeny?**

Interpretation guide:

- **Low RF + low entanglement** → Strong congruence between structural and sequence evolution
- **High RF** → Potential structural convergence, evolutionary decoupling, domain rearrangement, or alignment artifacts

---

## Requirements

| Package | Purpose |
|---------|---------|
| `ape` | Tree I/O and manipulation |
| `phangorn` | Robinson–Foulds distance |
| `dendextend` | Tanglegram construction and entanglement scoring |
| `viridisLite` | Colorblind-safe cluster palette |
